<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Admin â€“ Enable Notifications</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="/manifest.json">
</head>
<body style="font-family: sans-serif; padding: 2rem;">
  <h1>Admin Notification Center</h1>
  <button id="enable" style="padding: 1rem 2rem; font-size: 1.2rem;">Enable Push Notifications</button>
  <p id="status">Status: not subscribed</p>

  <script type="module">
    const supabaseUrl = 'https://offrohhavllnldqrofck.supabase.co';       
    const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9mZnJvaGhhdmxsbmxkcXJvZmNrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NjIzNzcsImV4cCI6MjA3OTIzODM3N30.fyUPt8W1Di9dFXKBqDAO0VOaMEmng2EQOPFyLE2RzIc' ;                      

    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
    const supabase = createClient(supabaseUrl, supabaseAnonKey);

    const vapidPublicKey = 'BKMrtHn1zpg8k7pU-aXhmgMbtu0FKMWfKQQv1osfT7FNKwWAbwvlwYvONy0YJ-ip8G4RsIQWZvXwlU_fuA-6Luw';

    document.getElementById('enable').onclick = async () => {
      const status = document.getElementById('status');
      status.textContent = 'Registering service worker...';

      try {
        const reg = await navigator.serviceWorker.register('/sw.js');
        await navigator.serviceWorker.ready;

        const sub = await reg.pushManager.subscribe({
          userVisibleOnly: true,
          applicationServerKey: vapidPublicKey
        });

        await supabase.from('push_subscriptions').upsert({ subscription: sub.toJSON() });

        status.textContent = 'Success! You will now get notifications even when the site is closed!';
        document.getElementById('enable').disabled = true;
      } catch (err) {
        status.textContent = 'Error: ' + err.message;
        console.error(err);
      }
    };
  </script>
</body>
</html>
